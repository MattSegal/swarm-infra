##
# Virtual Host Configs
##

##
# Redirect HTTP to  HTTPS
##
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name
        redditfeed.xyz
        whatsonmelb.fun
        www.whatsonmelb.fun
        memories.ninja
        www.memories.ninja
        www.mattslinks.xyz
        mattslinks.xyz;
    return 301 https://$host$request_uri;
}

##
# Reverse proxy all HTTPS requests to gunicorn
# https://certbot.eff.org/lets-encrypt/ubuntuxenial-nginx
##
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name memories.ninja www.memories.ninja;
    ssl_certificate /etc/letsencrypt/live/memories.ninja/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/memories.ninja/privkey.pem;
    include ssl-params.conf;
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
    }
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.mattslinks.xyz;
    ssl_certificate /etc/letsencrypt/live/www.mattslinks.xyz/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.mattslinks.xyz/privkey.pem;
    include ssl-params.conf;
    return 301 https://mattslinks.xyz$request_uri;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name mattslinks.xyz;
    ssl_certificate /etc/letsencrypt/live/mattslinks.xyz/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/mattslinks.xyz/privkey.pem;
    include ssl-params.conf;
    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
    }
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name redditfeed.xyz;
    ssl_certificate /etc/letsencrypt/live/redditfeed.xyz/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/redditfeed.xyz/privkey.pem;
    include ssl-params.conf;
    location / {
        proxy_pass http://127.0.0.1:8002;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
    }
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.whatsonmelb.fun;
    ssl_certificate /etc/letsencrypt/live/www.whatsonmelb.fun/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.whatsonmelb.fun/privkey.pem;
    include ssl-params.conf;
    return 301 https://whatsonmelb.fun$request_uri;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name whatsonmelb.fun;
    ssl_certificate /etc/letsencrypt/live/whatsonmelb.fun/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/whatsonmelb.fun/privkey.pem;
    include ssl-params.conf;
    location / {
        proxy_pass http://127.0.0.1:8003;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
    }
}
